# Chap9 장애 대응하기(Incident Reponse)

참고: SRE Chap14 장애관리하기

효과적인 장애 관리의 핵심은 장애로 인한 피해를 최소화하고 최대한 빨리 평소의 비즈니스 운영을 복구하는 것입니다. 잠재적인 장애에 대한 대처를 사전에 수행하지 않으면 실제 상황에서는 원리에 기초한 장애 관리 따위는 쓸모없는 것이 되어 버리기 떄문입니다.

## 장애 관리 절차의 기본 요소들

장애 관리 기술과 기량은 열정적인 개인의 에너지를 연결하기 위해 존재합니다. 장애 관리 시스템은 미국의 소방관들이 산불을 대처하는 방법인 장애 제어 시스템(Incident Command System)을 기반으로 합니다.

### 장애 제어 시스템(ICS, Incident Command System)

장에 제어 시스템은 3Cs(three Cs) 라고 불리는 다음의 목표를 가지고 있습니다.

• 대응 노력에 대한 조절(Coordinate response effort)
• 조직 내/외부의 장애 응답자와의 커뮤니케이션(Communicate between incident responders, within the organization, and to the outside world)
• 장애 응답에 대한 제어 유지(Maintain control over the incident response)

만약 장애 대응 과정에서 문제가 발생한다면 위와 관련된 영역에서 발생할 확률이 높습니다. 3Cs을 완전히 익히는 것은 효과적인 장애 대응에 필수적인 요소입니다.

제대로 된 장애 관리 절차는 다음과 같은 특징이 있습니다.

### 책임에 대한 귀납적인 분리

장애 조치에 참여 중인 모든 사람들이 자신의 역할을 명확히 이해하고 다른 이의 영역을 침범하지 않도록 하는 것이 가장 중요합니다. 책임에 대한 명확한 분리는 개개인의 자율성을 보장합니다. 각자 동료들의 행동에 대해 예상이나 예측을 할 필요가 없기 때문입니다.

만일 누군가의 업무 부하가 감당하기 힘들 정도로 높아지면 그 사람은 계획을 수립하는 리더에게 더 많은 지원 인력을 요청해야 합니다. 그런 후 자신의 업무를 보충된 인력에게 나누어주어야 합니다. 하지만 그러다 보면 또 다른 문제가 생길 수도 있습니다. 아니면 역할 리더가 시스템 컴포넌트를 다른 동료들에게 나누어주고 이드로부터 좀 더 높은 수준의 정보를 보고받을 수도 있습니다.

특정 개인에게 위임해야 하는 역할들은 다음과 같습니다.

#### IC(장애 제어자, Incident Commander, 장애 제어)

장애가 발생하면 가장 먼저 장애를 선언하는 사람은 장애 제어자가 됩니다. 장애 제어자(incident commander)는 장애에 대한 높은 수준의 상태를 확인을 하고, 3Cs에 맞추어 다음과 같은 역할에 집중합니다.

- 장애 조치를 위한 팀을 구성하고 필요와 우선순위에 따라 책임을 나누어줍니다.
- 효과적인 커뮤니케이션을 합니다.
- 장애 대응에 대한 제어를 유지해야합니다.
- 다른 사람에게 위임되지 않은 모든 역할을 수행해야 합니다. 필요하다면 운영팀이 효율적으로 업무를 수행하는 데 있어 방해가 되는 요소는 모두 해소해주어야 합니다.

#### OL(Ops 리드, Ops Lead, 운영 업무)

Ops 조직의 리드는 장애 제어자와 협력하여 운영 도구들을 이용해 실제 업무를 수행함으로써 장애에 대처합니다. 장애를 조치하는 동안에는 오직 운영팀만이 시스템을 변경할 수 있어야 합니다.

#### CL(커뮤니케이션 리드, Communication Lead, 의사소통)

커뮤니케이션 리드는 장애 조치팀의 대외 창구입니다. 가장 큰 역할은 장애 대응팀의 현황을 정기적으로 의사 결정자들에게 전달하고 문의에 대한 응답을 하는 것이며, 장애 조치 문서를 최신의 상태로 유지하는 역할도 겸해서 수행할 수 있습니다.

#### SL(계획 리드, Schedule Lead, 계획)

계획 업무를 담당한 사람은 운영팀을 도와 버그를 수집하거나, 저녁 식사를 주문하거나, 업무 분장을 돕거나, 시스템이 원래 상태에서 어떠헥 변경되는지를 추적한 후 장애가 조치된 후 이를 원래대로 복구하는 등 좀 더 장기적인 이슈들을 처리합니다.

### 확실한 컨트롤 타워

장애 조치에 참여 중인 사람들은 장애 제어자와 어떻게 소통해야 하는지를 명확하게 이해하고 있어야 합니다. 대부분의 경우 장애 조치 팀원들은 **전쟁터(War Room)** 로 활용할 목적으로 만들어진 공간에 함께 있는 것이 좋습니다. 다른 팀들은 본래 각자의 위치에서 일하기를 원할 수도 있지만 이 경우에는 이메일이나 IRC 등으로 장애에 대한 상황을 지속적으로 통보받을 수 있어야 합니다.

IRC는 신뢰성이 높고 장애에 대한 의사소통의 로그로도 사용할 수 있으며, 이런 기록은 지금까지 변경한 내용들을 기억하는데 큰 도움이 됩니다. 우리는 장애에 관련된 트래픽에 대한 로그(포스트모텀 분석에 매우 효과적입니다)를 기록하는 봇(bot)과 채널을 통해 공유된 알림 등에 대한 로그를 수집하는 봇들을 작성하면 도움이 됩니다.

### 실시간 장애 조치 문서

장애 제어자의 가장 중요한 역할 중 하나는 장애 조치 문서를 실시간으로 관리하는 것입니다. 이 문서를 위키에 생성할 수 있지만, 이상적으로는 누구든지 동시에 편집할 수 있어야 합니다.

실시간 문서를 조금 복잡해질 수는 있지만 반드시 실용적이어야 한다. 템플릿을 이용하면 이 문서를 쉽게 생성할 수 있으며, 문서의 최상단에 가장 중요한 정보들을 기록해놓으면 유용하게 참조할 수 있습니다. 이 문서는 포스트모템 분석을 위해 계속 유지되어야 하며, 필요하다면 메타 분석에도 이 문서를 활용할 수 있습니다.

### 명확하고 즉각적인 업무 이관

새로운 장애 제어자에게 완전히 업무를 인계 할 시 인수자(이전 장애 제어자)는 "이제 당신이 장애 제어자입니다. 알겠죠?" 와 같이 명확하게 업무를 이관하고 회사 전체가 이 업무의 이고나에 대해 인지할 때까지 연락을 끊어서는 안 된다. 업무의 이관은 장애를 조치하고 있는 다른 사람에게도 모두 전달되어 누가 이 장애를 관리하고 있는지를 명확하게 해야 한다.

## 적절하게 관리한 장애 조치 (예시)

## 언제 장애를 선언할 것인가?

문제가 심각해졌을 때 부랴부랴 장애 관리 프레임워크를 발동시키는 것보다는 장애를 빨리 선언하고 최대한 간결한 해결책을 찾아 장애를 조치하는 것이 더 낫다. 그러려면 어떤 상황에 장애를 선언할 것인지에 대한 명확한 조건을 수립해야 한다. 다음과 같은 가이드 라인을 만을어서, 어느 한 조건이라도 해당된다면 이를 장애라고 판명합니다.

- 문제를 해결하기 위해 다른 팀의 도움이 필요한가?
- 문제가 사용자에게 영향을 미쳤느가?
- 문제 발생 이후 한 시간 동안 집중적으로 분석했는데도 문제가 해결되지 않았는가?

## 연습하기

장애가 발생할 시점에 어떻게 장애를 관리할지 고민한다면 이미 늦었습니다. 장애 관리 프로세스에 대한 고민은 장애가 발생하기 전에 시작해야 합니다.

### 장애 대응 훈련하기

실제 응급 상황에 따라야 할 패턴을 갖도록 팀을 교육 할 것을 적극 권장합니다. 어떻게 장애를 준비하고, 어떻게 장애 상황 전반에 걸쳐 공통 언어를 사용하고 동일한 기대치를 공유하는 방법을 알게 되면 미스커뮤니케이션 실수를 줄일 수 있습니다.

#### 시작하기 전

##### 커뮤니케이션 채널 정하기

장애 대응 시 활용할 슬랙, IRC, 힙챗과 같은 커뮤니케이션 채널을 정해야 합니다. 이미 팀원들이 익숙한 커뮤니케이션 채널을 정하는 것을 추천합니다.

##### 고객/내부 동료들에게 지속적으로 알리기

장애가 발생한 상황에 대해 내/외부적으로 선언하고 이후에도 지속되고 있다는 사실을 인정하더라고, 사람들은 실제로 이슈를 해결하기 위해 어떤 행동이 이루어 지고 있는지 모르고, 아무런 행동도 하지 않는다고 생각할 수도 있습니다. 비슷하게 이슈가 줄어들거나 해결되었다고 하더라도, 그들은 장애가 지속되고 있다고 인지할 수도 있습니다.

정기적인 상태 업데이트를 통해 장애 전체에 대한 정보를 제공함으로써 이러한 문제를 예방 할 수 있습니다. 또한 연락처 목록을 준비해 둔다면 시간을 절약하고 누구도 놓치지 않도록 할 수 있습니다.

공개 블로그나 보도자료의 초안을 작성하고, 리뷰하고, 승인하여 배포할 때 까지의 과정을 생각해봐야 합니다. 외부 PR과 관련된 팀에게 가이드를 받는 것도 좋습니다. 두세가지의 바로 사용 가능한 템플릿들을 준비해 두어야 합니다. 아무도 극심한 스트레스 상황에서 가이드라인 없이 이러한 발표 내용을 작성하는 것을 원하지 않습니다. 템플릿은 정보를 공개하기 쉽고 스트레스 받지 않도록 해야 합니다.

##### 연락처 리스트를 준비하기

연락처 리스트를 가지고 있는 것은 시간과 노력을 아끼는데 도움이 됩니다.

##### 장애 기준 정의하기

때로는 명확하지 않은 상황에서 장애가 발생할 경우 실제로 장애인지 확인하는 과정 자체가 문제가 될 수 있습니다. 발생한 이슈가 실제로 장애인지 결정하기 위한 기준 리스트를 정의해두는 것이 도움이 됩니다. 위험도가 높은 분야에 대한 이전 장애들을 참고하면 확실한 기준 리스트를 만들 수 있습니다.

요약해보면, 장애 대응 시 조정과 커뮤니케이션을 위한 공통되는 기반을 만드는 것이 중요합니다. 장애를 알리는 방법, 알림 대상이 누구인지, 장애 책임자가 누군지 결정해야 합니다. 이러한 가이드라인들은 준비하기 쉽고 장애를 해결하는 시간을 줄이는데 큰 효과가 있습니다.

## 장애 조치에 대한 모범 사례(요약)

- 우선순위: 우선 출혈을 막고 서비스를 되살린 후에 근본 원인에 대한 증거를 찾자.
- 사전 준비: 장애 조치에 참여한 사람들의 자문을 받아 장애 관리 절차를 미리 개발하고 문서화 해두자.
- 신뢰: 장애 조치에 참여 중인 모든 사람들에게 충분한 자율권을 보장하자.
- 감정 조절: 장애를 조치하는 동안 스스로의 감정적 상태에 주의를 기울이자. 만일 너무 부담이 된다면 다른 이에게 도움을 청하자.
- 대체 방안데 대한 모색: 주기적으로 현재 선택할 수 있는 방법에 대해 다시 생각하고 이 방법이 여전히 유효한지, 아니면 다른 방법을 찾아야 하는지를 판단하자.
- 실습: 이 과정을 정기적으로 수행해서 자연스럽게 활용할 수 있는 수준으로 만들자.
- 개선: 그리고 계속해서 개선하자. 모든 팀 구성원들이 모든 역할에 익숙해질 수 있도록 독려하자.
